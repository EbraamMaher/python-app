pipeline {

    agent {label 'agent'}

    stages{
        stage('Build') {
          steps {
            script {
              withCredentials([usernamePassword(credentialsId: 'docker', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) { 

              sh """
               
                docker login -u ${USERNAME} -p ${PASSWORD}
                docker ps 
                """
                    }
                        } 
                }
            }
    

        stage('Deploy') {
          steps{
            script {
                 withCredentials([file(credentialsId: 'baz', variable: 'omar')]){
                            // sh "kubectl config set-context $(kubectl config current-context)"   // --namespace=${namespace}

                            sh """
                              //gcloud auth activate-service-account --key-file="$omar"
                              // gcloud container clusters get-credentials app-cluster --region europe-west3 --project gproject-368612 
                              kubectl get pods -A
                            """
                }

              }
            }
          }
        }

}
        
